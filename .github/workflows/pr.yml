script: |
  set -e

  echo "=== ğŸ” TESTE SSH ==="
  whoami
  hostname
  pwd
  echo "SSH OK"

  echo "=== ğŸ“¦ TESTE KUBECTL ==="
  which kubectl
  kubectl version --client
  kubectl get nodes

  PR_NUMBER=${{ github.event.pull_request.number }}
  NAMESPACE=pr-${PR_NUMBER}

  echo "=== ğŸ“‚ CRIANDO / VALIDANDO NAMESPACE ==="
  kubectl get ns ${NAMESPACE} || kubectl create ns ${NAMESPACE}

  echo "=== ğŸš€ DEPLOY DEPLOYMENT ==="
  sed "s|IMAGE_PLACEHOLDER|nginx:alpine|g" k8s/base/deployment.yml \
    | kubectl apply -n ${NAMESPACE} -f -

  echo "=== ğŸ”Œ DEPLOY SERVICE ==="
  kubectl apply -n ${NAMESPACE} -f k8s/base/service.yml

  echo "=== ğŸŒ DEPLOY INGRESS PR ==="
  sed "s|PR_NUMBER|${PR_NUMBER}|g" k8s/overlays/pr/ingress.yml \
    | kubectl apply -n ${NAMESPACE} -f -

  echo "âœ… PR ${PR_NUMBER} publicado em:"
  echo "https://pr-${PR_NUMBER}.cluster.stringtecnologiadf.org"
